# Product Requirements Document (Current Baseline + Next Iterations)

## Product Statement

Build an agentic commerce platform for persistent omnichannel conversational
sales and autonomous retail task orchestration.

Current release is a responsive web implementation that shares backend
contracts intended for future mobile and kiosk channels.

## Problem Statement

Traditional ecommerce flows create friction:

- Users must navigate many pages for simple shopping tasks.
- Cart and conversation context are often lost across sessions/devices.
- Support and order operations are fragmented.
- Cart abandonment is high and follow-up is inconsistent.

## Target Users

| Segment | Primary Need |
| --- | --- |
| Guest shoppers | Browse and build cart quickly before account creation |
| Registered shoppers | Continue prior context and checkout efficiently |
| Returning shoppers | Receive personalized recommendations and memory-aware assistance |
| Operations/admin users | Manage catalog, inventory, support, and recovery workflows |

## Product Goals

### Primary Goals

- Enable natural-language shopping operations end-to-end.
- Preserve session/cart/conversation continuity through guest -> authenticated transition.
- Require authentication before order creation without losing guest progress.
- Improve cart recovery using outbound voice orchestration guardrails.

### Secondary Goals

- Provide operational visibility (health, metrics, admin activity integrity).
- Keep architecture channel-ready for future mobile and kiosk clients.

## Scope

### In Scope (Current v1)

- Responsive web app (desktop and mobile browser form factors).
- Catalog browsing and product detail page.
- Guest session and cart management.
- Register/login with guest cart merge.
- Auth-required order creation with idempotency enforcement.
- Conversational assistant over WebSocket/REST for product/cart/order/support/memory intents.
- User preference memory and history-aware responses.
- Admin management APIs for categories/products/inventory/support/voice settings.
- SuperU-based voice recovery pipeline with callback ingestion and controls.

### Out Of Scope (Current v1)

- Native iOS/Android app shell.
- Native kiosk app shell.
- Real payment processor integration.
- Compliance/regulatory workflows.

## Functional Requirements

### FR-1 Guest Shopping

Requirement:
Guests can browse products and manage cart without authentication.

Acceptance:

- Session auto-creation via API/WS flow.
- Add/update/remove cart items as guest.
- Cart totals recalculate in real time.

Status: Implemented.

### FR-2 Authentication And Transition

Requirement:
User can register/login and retain guest progress.

Acceptance:

- Register/login returns auth tokens and resolved `sessionId`.
- Guest cart merges into authenticated cart.
- Session is linked to authenticated identity.

Status: Implemented.

### FR-3 Checkout Gate

Requirement:
Order creation requires authenticated user.

Acceptance:

- `POST /v1/orders` rejects unauthenticated requests.
- `Idempotency-Key` required on order creation.
- Guest checkout attempts preserve cart and prompt login.

Status: Implemented.

### FR-4 Conversational Orchestration

Requirement:
Assistant handles natural-language shopping/support tasks.

Acceptance:

- Supports product discovery and cart actions (add/update/remove/clear/view).
- Supports order actions (checkout summary/status/address change/cancel/refund).
- Supports support-ticket escalation/status/close.
- Returns structured suggested actions for UI quick actions.

Status: Implemented.

### FR-5 Preference Memory

Requirement:
System stores and uses account-level memory.

Acceptance:

- Save/show/forget/clear preference commands are supported.
- Memory updates on authenticated interactions.
- Interaction history fallback is used when session history is sparse.

Status: Implemented.

### FR-6 Product Detail Experience

Requirement:
Each product has a detail view with variant and quantity selection.

Acceptance:

- Route `/products/{id}` displays product fields and variants.
- Variant selection validates stock before add-to-cart.

Status: Implemented.

### FR-7 Voice Recovery For Abandoned Carts

Requirement:
Abandoned carts can trigger outbound recovery calls.

Acceptance:

- Queue/retry/dead-letter lifecycle is implemented.
- Quiet hours, caps, budget, suppressions, kill switch are enforced.
- Signed SuperU callback updates call outcomes.

Status: Implemented (requires SuperU credentials/config).

## Natural Language User Stories (Current)

Users can ask the assistant to:

- Find products with constraints (price/category/color/brand).
- Add one or multiple products to cart.
- Increase/decrease/set/remove cart quantities.
- Apply discount code.
- View/clear cart.
- Checkout (with auth gate).
- Track/cancel/refund orders and change shipping address.
- Open/check/close support tickets.
- Save and manage preference memory.

## Non-Functional Requirements

| Metric | Target |
| --- | --- |
| API latency (p95) | < 500ms |
| LLM latency (p95, when enabled) | < 3s |
| WebSocket delivery latency | < 200ms |
| DB query latency (p95) | < 100ms |
| Availability target | 99.9% |

Notes:

- Targets are design goals; final production SLOs require load testing in deployed infra.

## Security And Operational Requirements

- JWT auth with refresh rotation.
- Role-based access for admin APIs.
- Per-tier rate limiting and request hardening.
- WebSocket origin validation.
- Prometheus metrics and health checks.
- Admin activity integrity verification endpoint.

## Release Criteria For Current Web v1

- End-to-end guest -> auth -> checkout path passes.
- Conversational flows cover product/cart/order/support/memory baseline intents.
- Product detail route and cart UI flows are stable.
- Voice recovery endpoints and controls function with valid provider configuration.
- CI pipeline passes backend tests, frontend lint/build, and e2e suite.

## Post-v1 Priorities

1. Native mobile shell using existing APIs/WebSocket contracts.
2. Native kiosk shell using same orchestration backend.
3. External payment processor integration.
4. Compliance and regulatory controls.
